require "fileutils"
include FileUtils

desc "clean log"
task :clean do
  Dir.glob 'var/*' do |f|
    File.open(f, 'w'){}
  end
end

desc "prepare and config"
task :config do
  sh 'erb nginx.conf.erb > nginx.conf'
  mkdir_p 'root', :verbose => true
  mkdir_p 'var', :verbose => true
end

desc "start server"
task :server do
  sh 'rackup -E production -D config.ru && sudo nginx -c `pwd`/nginx.conf'
end

desc "grep server processes"
task :show do
  exec 'ps ax|grep "nginx\|ruby"|grep -v "ps ax\|grep"'
end
